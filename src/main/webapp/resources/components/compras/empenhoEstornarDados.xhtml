<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:mcl="http://java.sun.com/jsf/composite/components/mcl">

<!-- INTERFACE -->
<composite:interface>
	<composite:attribute name="managedBean" required="true" />
	<composite:attribute name="readonly" type="java.lang.Boolean" />
</composite:interface>

<!-- IMPLEMENTATION -->
<composite:implementation>
	<h:form id="empenhoForm" class="smart-form" acceptcharset="ISO-8859-1">
		<fieldset>
			<p:panel header="Dados do Fornecedor">
				<div class="row">
					<section class="col col-3">
						<p:outputLabel value="Código" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.fornecedorCodigo}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<p:outputLabel value="Documento" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.fornecedorNumeroDocumento}" readonly="true" />
						</label>
					</section>
					<section class="col col-6">
						<p:outputLabel value="Razão Social" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.fornecedorRazaoSocial}" readonly="true" />
						</label>
					</section>
				</div>
			</p:panel>
			<br/>
			<p:panel header="Dados do Processo">
				<div class="row">
					<section class="col col-3">
						<p:outputLabel value="Número" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.processo.numero}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<p:outputLabel value="Ano" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.processo.ano}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<p:outputLabel value="Modalidade" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.processo.modalidade.descricao}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<mcl:money label="Valor" value="#{cc.attrs.managedBean.empenho.processo.valor}" readonly="true" />
					</section>
				</div>
			</p:panel>
			<br/>
			<p:panel header="Dados do Empenho">
				<div class="row">
					<section class="col col-3">
						<p:outputLabel value="Tipo Empenho" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.tipoEmpenho.descricao}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<p:outputLabel value="Número" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.numero}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<p:outputLabel value="Ano" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.processo.ano}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<p:outputLabel value="Data" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.data}" readonly="true">
								<f:convertDateTime pattern="dd/MM/yyyy" />
							</p:inputText>
						</label>
					</section>
				</div>
				<section>
					<p:outputLabel value="Descrição" styleClass="label" />
					<label class="input">
						<p:inputText value="#{cc.attrs.managedBean.empenho.descricao}" readonly="true" />
					</label>
				</section>
				<div class="row">
					<section class="col col-3">
						<p:outputLabel value="Dotação Número" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.dotacaoNumero}" readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<p:outputLabel value="Dotação CND" styleClass="label" />
						<label class="input">
							<p:inputText value="#{cc.attrs.managedBean.empenho.dotacaoCnd} " readonly="true" />
						</label>
					</section>
					<section class="col col-3">
						<mcl:money label="Valor" value="#{cc.attrs.managedBean.empenho.valor}" readonly="true" />
					</section>
					<section class="col col-3">
						<mcl:money label="Valor a Liquidar" value="#{cc.attrs.managedBean.empenho.valorALiquidar}" readonly="true" />
					</section>
				</div>
				<div class="row">
					<section class="col col-3">
						<mcl:money label="Valor Total Estornado" value="#{cc.attrs.managedBean.empenho.valorTotalEstornado}" readonly="true" />
					</section>
					<section class="col col-3">
						<mcl:money label="Valor Total Liquidado" value="#{cc.attrs.managedBean.empenho.valorTotalLiquidado}" readonly="true" />
					</section>
					<section class="col col-3">
						<mcl:money label="Valor Total AF" value="#{cc.attrs.managedBean.empenho.valorTotalAf}" readonly="true" />
					</section>
					<section class="col col-3">
						<mcl:money label="Valor Disponível AF" value="#{cc.attrs.managedBean.empenho.valorDisponivelAf}" readonly="true" />
					</section>
				</div>
			</p:panel>
		</fieldset>
			
		<fieldset>
						
			<p:panel id="painelItens" header="Itens de Requisição cobertos por este Empenho">
				<div class="row" style="margin: 3px;" >
					<section>
						<alert dismissible="true" type="info">
							<div role="alert" class="alert alert-info alert-dismissible ng-star-inserted">  
			          			<i class="fa-fw fa fa-info-circle"></i>
			          			<strong>OBSERVAÇÃO </strong>:<br/>
			          			Um Item de requisição pode ter <STRONG>mais de um Empenho</STRONG> ( casos de convênios ou Processos Pluri Anuais).<BR />
			          			Portanto, o valor empenhado <STRONG>do Item</STRONG> pode representar o valor deste Empenho e de outros que eventualmente foram emitidos para cobrir o Item.
		         			</div>
		        		</alert>
					</section>
				</div>
					
				<div class="row" style="margin: 3px;">
					<section>
						<p:dataTable id="dtItemRequisicao" var="item" value="#{cc.attrs.managedBean.itemRequisicaoCompraList}"
							reflow="true" emptyMessage="Não constam registros." tableStyleClass="table table-striped"
							styleClass="table-reflow-desktop">
		
						    <p:column headerText="Requisição" style="width: 80px">
						        <h:outputText value="#{item.requisicaoCompra.numero}" />
						    </p:column>
						    <p:column headerText="Item" style="text-align:right; width: 50px">
						    	<h:outputText value="#{item.item}" modoConsulta="true" />
						    </p:column>
						    <p:column headerText="Objeto">
						        <h:outputText value="#{item.material.descricao}" title="#{item.material.descricao}" rendered="#{item.material != null}" />
						        <h:outputText value="#{item.servico.descricao}" title="#{item.servico.descricao}" rendered="#{item.servico != null}" />
						    </p:column>
						    <p:column headerText="Concluído" style="text-align:center; width: 70px">
						        <h:outputText value="#{item.concluido ? 'Sim' : 'Não'}" />
						    </p:column>
		
						    <p:column headerText="Quantidade" style="width: 100px">
						    	<mcl:money value="#{item.quantidadeSolicitada}" modoConsulta="true" />
						    </p:column>
						    <p:column headerText="Unidade" style="width: 100px">
				        		<h:outputText value="#{item.material != null ? item.material.unidade.nome : item.servico.unidade.nome}" />
						    </p:column>
						    <p:column headerText="Valor Unitário" style="width: 120px">
						    	<mcl:money value="#{item.valorUnitario}" decimalPlaces="4" modoConsulta="true" />
						    </p:column>
						    <p:column headerText="Valor" style="width: 120px">
						    	<mcl:money value="#{item.valorTotalSolicitado}" modoConsulta="true" />
						    </p:column>
						    <p:column headerText="Valor Empenhado" style="width: 120px">
						    	<mcl:money value="#{item.valorTotalEmpenhado}" modoConsulta="true" />
						    </p:column>
						    <p:column headerText="Valor Estornado" style="width: 120px">
						    	<mcl:money value="#{item.valorTotalEstornado}" modoConsulta="true" />
						    </p:column>
						    <p:column headerText="Valor Possível Estornar" style="width: 120px">
						    	<mcl:money value="#{item.valorPossivelEstornar}" modoConsulta="true" />
						    </p:column>
					        <p:column headerText="Valor a Estornar" style="width: 120px">
						    	<mcl:money value="#{item.valorDesejado}"  />
						    </p:column>
						</p:dataTable>	
					</section>
				</div>
			</p:panel>
		</fieldset>
	
		<footer>
			<section>
				<alert dismissible="true" type="info">
					<div role="alert" class="alert alert-warning alert-dismissible ng-star-inserted">  
	          			<i class="fa-fw fa fa-info-circle"></i>
	          			<strong>ATENÇÃO </strong>:<br/>
	          			Os Estornos de Empenhos são feitos diretamente no Sistema MFC da Contabilidade e, uma vez gravado, <b>não há como desfazer</b> !<BR />
	          			Se o estorno for parcial, certifique-se dos valores e quais itens estarão envolvidos no Estorno de Empenho.
	        			</div>
	       		</alert>
			</section>
		
            <h:commandLink value="" action="#{cc.attrs.managedBean.voltar()}" styleClass="btn btn-primary btn-lg pull-left"
            	immediate="true">
            	<i class="fa fa-arrow-left"></i>
            	<h:outputText value="  Voltar" />
            </h:commandLink>
            
			<h:commandLink value="" action="#{cc.attrs.managedBean.salvarEstornoParcial()}" styleClass="btn btn-success btn-lg"
				title="Estorna o Empenho nos valores indicados em cada Item"
				rendered="#{not cc.attrs.readonly}" onclick="$('.btn-success').attr('disabled', true);">
            	<i class="fa fa-save"></i>
            	<h:outputText value="  Estorno Parcial" />
            </h:commandLink>
            
			<h:commandLink value="" action="#{cc.attrs.managedBean.salvarEstornoTotal()}" styleClass="btn btn-danger btn-lg"
				title="Estorna o Empenho no seu valor total disponível"
				rendered="#{not cc.attrs.readonly}" onclick="$('.btn-danger').attr('disabled', true);">
            	<i class="fa fa-save"></i>
            	<h:outputText value="  Estorno TOTAL" />
            </h:commandLink>
            
            
		</footer>
	</h:form>
	
</composite:implementation>

</html>	